---
title: PHP官方文档阅读
date: 2017-12-29 09:03:43
categories:
- PHP
- 正文
---

# PHP官方文档阅读

## 语言参考

### 基本语法

#### 从HTML中分离

本节笔记：
在本节中写到PHP的几种开始和结束标记。如：
```
1.  <?php echo 'if you want to serve XHTML or XML documents, do it like this'; ?>

2.  <script language="php">
        echo 'some editors (like FrontPage) don\'t
              like processing instructions';
    </script>

3.  <? echo 'this is the simplest, an SGML processing instruction'; ?>
    <?= expression ?> This is a shortcut for "<? echo expression ?>"

4.  <% echo 'You may optionally use ASP-style tags'; %>
    <%= $variable; # This is a shortcut for "<% echo . . ." %> 
```

但在实际情况中，很多标签在PHP7中已经删除。在[官方wiki](https://wiki.php.net/rfc/remove_alternative_php_tags)中写到:
```
The following syntactical elements are removed:

* <% opening tag
* <%= opening tag with echo
* %> closing tag
* (<script\s+language\s*=\s*(php|"php"|'php')\s*>)i opening tag
*(</script>)i closing tag
```

### 类型

#### 简介

本节笔记：
PHP的变量的类型不是由程序员决定的，而是由PHP根据该变量使用的上下文在运行时决定的。
如果想查看某个表达式的值和类型，用`var_dump()`函数。如果只查看类型，用`gettype()`函数，如果验证类型，使用`is_type`，如：
```
<?php
$a = TRUE;
$b = 3;
echo gettype($a);	//输出*boolean*
echo '</br>';
echo var_dump($b);	//输出*int(3) *
echo '</br>';
if(is_int($b)){
echo $b;			//输出*3*
}
echo '</br>';
?>
```

#### Integer 整型 

本节笔记：
整数型可以使用二进制(数字前加`0b`)、八进制(数字前加`0`)、十进制、十六进制(数字前加`0x`表示。前面可以加上可选符号`+/-`。
示例：
```
$d = 0x7FFFFFFFFFFFFFFF;
$d2 = 0b0111111111111111111111111111111111111111111111111111111111111111;
$e = 0x8000000000000000;
$e2 = 0b1000000000000000000000000000000000000000000000000000000000000000;
/*
if ($d == $d2){
    echo "d==d2 </br>";
}else{
    echo "d!=d2</br>";
}
if ($e == $e2){
    echo "e==e2<br>";
}else{
    echo "e!=e2<br>";
}
$d3 = $d +1;
if ($e == $d3){
    echo "e==d3<br>";
}else{
    echo "e!=d3<br>";
}
*/
echo decbin($e) . "<br>";
echo decbin($e2) . "<br>";
```
结果为：
```
d==d2 
e!=e2
e==d3
1000000000000000000000000000000000000000000000000000000000000000
111111111111111111111111111111111111111111111111111110000000000
```
~~原因未知。等后续研究。~~
阅读浮点型后猜测：由于`$e`与`$e2`属于浮点型，所以他们的值不能比较，结果肯定不会相同。

#### Float 浮点型 

本节笔记：
由于历史原因，float类型有一个其他名称：double，这两个类型完全相同。
浮点的精度有限，取决于系统。永远不要相信浮点数结果精确到了最后一位，也永远不要比较两个浮点数是否相等。
从浮点数转换为整数时，向下取整。
```
<?php
$a = (0.1+0.7) * 10 ;
$b = (0.1+0.9) * 10 ;
var_dump($a);
echo "<br>";
var_dump($b);
echo "<br>";
echo decbin($a) . "<br>";
echo decbin($b) . "<br>";
echo (int) ($a);
echo "<br>";
echo (int) ($b);
echo "<br>";
echo decbin(22.33); 
?> 
```
结果为：
```
float(8) 
float(10) 
111
1010
7
10
10110
```
可以看到当把浮点型数值二进制输出时，PHP已经内部将其转化过了。
在**[计算机中的浮点运算](http://blog.jobbole.com/95343/)**一文中关于这个问题有过分析：
> 对于十进制数值系统（就是我们现实中使用的），它只能表示以进制数的质因子为分母的分数。10 的质因子有 2 和 5。因此 1/2、1/4、1/5、1/8和 1/10 都可以精确表示，因为这些分母只使用了10的质因子。相反，1/3、1/6 和 1/7 都是循环小数，因为它们的分母使用了质因子 3 或者 7。二进制下（进制数为2），只有一个质因子，即2。因此你只能精确表示分母质因子是2的分数。二进制中，1/2、1/4 和 1/8 都可以被精确表示。但是，1/5 或者 1/10 就变成了循环小数。所以，在十进制中能够精确表示的 0.1 与 0.2（1/10 与 1/5），到了计算机所使用的二进制数值系统中，就变成了循环小数。当你对这些循环小数进行数学运算时，并将二进制数据转换成人类可读的十进制数据时，会对小数尾部进行截断处理。

当需要测试浮点数是否相等，要使用一个仅比该数值大一丁点的最小误差值。该值也被称为机器极小值（epsilon）或最小单元取整数，是计算中所能接受的最小的差别值。 
例如：
```
<?php
$a = 1.23456789;
$b = 1.23456780;
$epsilon = 0.00001;

if(abs($a-$b) < $epsilon) {
    echo "true";
}
?> 
```
`$a`与`$b`在小数点后五位精度内都是相等的。

#### String 字符串 

本节笔记：
单引号`'`字符串和nowdoc语法中的变量和特殊字符的转义序列不会被替换，在双引号`"`和heredoc 语法中的会被替换。
heredoc 语法示例：
```
<?php
echo <<< www  //开始标识符，命名规则：只能包含字母、数字和下划线，并且必须以字母和下划线作为开头
aaaaaaaaaaa
www;		//结束标识符，必须与开始标识符相同，不能有任何缩进，在 ; 后必须换行
```

heredoc的开始标识符可以用双引号包起来，nowdoc的写法与heredoc的写法类型，但开始标识符必须用单引号包起来。两者的结束标识符都不可以用任何符号包起来。
字符串可以用`.`运算符连接起来。

#### Array 数组 

array()定义的数组由任意个用`,`分隔的键值对组成。键(key)可以是一个整数或者字符串，值(value)可以是任意类型的值。
key的强制转换：
* 包含有合法整型值的字符串会被转换为整型。例如键名`8`实际会被储存为`8`。但是`08`则不会强制转换，因为其不是一个合法的十进制数值。 
* 浮点数也会被转换为整型，意味着其小数部分会被舍去。例如键名`8.7`实际会被储存为`8`。 
* 布尔值也会被转换成整型。即键名`true`实际会被储存为`1`而键名`false`会被储存为`0`。 
* `Null`会被转换为空字符串，即键名`null`实际会被储存为` `。 
* 数组和对象不能被用为键名。坚持这么做会导致警告`Illegal offset type`。 

如果对给出的值没有指定键名，则取当前最大的整数索引值，而新的键名将是该值加一。如果指定的键名已经有了值，则该值会被覆盖。 
删除某键值对或者某数组，调用`unset()`函数。

### 变量

#### 基础

一个有效的变量名由字母或者下划线开头，后面跟上任意数量的字母，数字，或者下划线。
变量名可以使用中文字符，如`$中国`,但不推荐使用。

#### 变量范围

PHP中的全局变量用关键字`global`声明。
```
<?php
$a = 1;
$b = 2;

function Sum()
{
    global $a, $b;

    $b = $a + $b;
}

Sum();
echo $b;
?> 
```
输出结果为`3`。
在全局范围内访问变量的第二个办法，是用特殊的PHP自定义`$GLOBALS`数组。具体使用方法在预定义变量一节。
PHP中的静态变量用关键字`static`声明。静态变量仅在局部函数域中存在，但当程序执行离开此作用域时，其值并不丢失。
```
<?php
function test()
{
    static $a = 0;
    echo $a;
    $a++;
}
?> 
```
初次调用函数时，初始化`$a`为`0`，之后调用函数则在`$a`的值上加一。

#### 可变变量

通过一个示例来展示可变变量：
```
<?php
$a = 'hello';
$$a = 'world';
echo "$a ${$a}";	//等同于 echo "$a $hello";
?> 
```
输出结果为`hello world`。
可变变量用于数组时，使用花括号给属性清晰定界，如`${$a[1]}`表示将`$a[1]`作为一个变量，`${$a}[1]`表示将`${$a}`作为一个变量并取出索引为1的值。

### 运算符

太空船运算符`$a<=>$b`
```
1 <=> 2; //返回-1
1 <=> 1; //返回0
2 <=> 1; //返回1
```
NULL 合并操作符`$a??$b??$c`，返回从左往右第一个存在且不为 NULL 的操作数。如果都没有定义且不为 NULL，则返回 NULL。
```
$a = 1;
$b ?? $a; 	// 返回1
$b ?? $c;	// 返回null
```
三元运算符`(expr1) ? (expr2) : (expr3)`，对 expr1 求值为 TRUE 时的值为 expr2，在 expr1 求值为 FALSE 时的值为 expr3。可以省略中间的部分，表达式 `expr1 ?: expr3` 在 expr1 求值为 TRUE 时返回 expr1，否则返回 expr3。

### 流程控制

